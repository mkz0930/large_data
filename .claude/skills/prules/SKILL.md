---
name: prules
description: 在执行任何编码任务时使用此 skill，确保遵循用户的个人编码习惯和工作流程要求
invocable: true
---
# 个人编码标准和工作流程

> **自动应用**：任何涉及代码变更的任务都必须遵循此规范

---

## 核心原则（必须遵守）

### 1. 测试驱动开发（TDD）

- **测试先行**：先写测试，再写代码
- **红灯→绿灯**：测试失败 → 实现代码 → 测试通过
- **测试不过不提交**：测试失败必须修复或回滚

### 2. 文档维护（每次提交必须更新）

| 文档               | 路径                     | 说明                       |
| ------------------ | ------------------------ | -------------------------- |
| **项目说明** | `README.md`            | 项目概述和使用说明，根目录 |
| **需求文档** | `docs/REQUIREMENTS.md` | 项目整体需求，唯一一份     |
| **架构文档** | `docs/ARCHITECTURE.md` | 项目架构设计，唯一一份     |
| **变更日志** | `docs/CHANGELOG.md`    | 记录所有变更，必须维护     |

**提交公式：代码 + 测试 + 文档 + CHANGELOG = 完整提交**

### 3. 编码标准

- **中文注释**：所有注释使用中文
- **完整错误处理**：try-catch + 日志 + 用户提示
- **频繁提交**：小步迭代，随时可回滚

### 4. Bug 修复流程（必须遵守）

- **读取报错**：修复 bug 前，必须先读取并分析终端的完整报错信息
- **复现问题**：理解报错的根本原因，确认问题可复现
- **修复验证**：修复完成后，必须将触发 bug 的代码/命令转化为测试用例
- **测试通过**：新增的测试用例必须通过，才能认为 bug 已修复

```
Bug修复流程: 读取报错 → 分析原因 → 修复代码 → 添加测试用例 → 测试通过 ✓
```

**禁止行为**：
- ❌ 不读报错就猜测修复方案
- ❌ 修复后不添加对应测试用例
- ❌ 测试未通过就声称已修复

---

## 工作流程（4 阶段）

```
阶段1: 方案设计 ✋ → 阶段2: 编写测试 ✋ → 阶段3: 实现代码 ✋ → 阶段4: 验证提交 ✋
```

**交互模式（默认）**：每阶段等待用户确认
**自动模式**：请求中包含 `auto`/`自动` 关键词，跳过确认

### 阶段 1：方案设计 ✋

1. 理解需求，识别边界情况
2. 设计技术方案
3. 使用 TodoWrite 拆分任务，拆分5-50个步骤，越详细越好，方便debug，回滚

### 阶段 2：编写测试 ✋

1. 先写测试用例（正常/边界/异常）
2. 运行测试，确保失败（红灯）

### 阶段 3：实现代码 ✋

1. Git 提交创建回滚点
2. 编写实现代码
3. 运行测试，确保通过（绿灯）
4. 失败则回滚重试

### 阶段 4：验证提交 ✋

1. 运行完整测试套件
2. 更新三份核心文档
3. Git 提交（代码+测试+文档+CHANGELOG）

---

## 快速检查清单

- [ ] 需求理解 → 任务拆分 → 方案确认
- [ ] 写测试 → 红灯 → 写代码 → 绿灯
- [ ] 更新 `README.md`（如有项目说明变更）
- [ ] 更新 `docs/REQUIREMENTS.md`（如有需求变更）
- [ ] 更新 `docs/ARCHITECTURE.md`（如有架构变更）
- [ ] 更新 `docs/CHANGELOG.md`（必须）
- [ ] Git 提交

---

## 参考文档

详细规范请查阅 `.claude/skills/prules/coding-standards/` 目录：

| 文档                         | 内容           | 调用时机                                       |
| ---------------------------- | -------------- | ---------------------------------------------- |
| `comments-guide.md`          | 注释规范       | 编写代码时，需要添加注释前查阅                 |
| `error-handling-guide.md`    | 错误处理规范   | 编写 try-catch、日志、异常处理时查阅           |
| `code-organization-guide.md` | 代码组织规范   | 创建新模块、重构代码、设计类结构时查阅         |
| `git-workflow-guide.md`      | Git 工作流规范 | 提交代码、创建分支、回滚操作时查阅             |
| `workflow-checklist.md`      | 完整检查清单   | 每个阶段完成后，用于自检是否遗漏               |
| `CHANGELOG-TEMPLATE.md`      | CHANGELOG 模板 | 阶段 4 更新 `docs/CHANGELOG.md` 时，按模板填写 |
